<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Structural Collapse Prediction AI (SCPA)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
    body{
        background: linear-gradient(135deg, #0b1020, #0a1a2f);
        color:#e8f0ff;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    .container{
        margin-top: 30px;
        margin-bottom: 30px;
    }
    .card{
        background: rgba(10, 16, 30, 0.85);
        border: 1px solid rgba(255,255,255,0.12);
        box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    }
    .progress{
        height: 14px;
        border-radius: 10px;
        overflow: hidden;
        background: rgba(255,255,255,0.12);
    }
    .progress-bar{
        background: linear-gradient(90deg, #6f42c1, #0dcaf0);
    }
    .btn-primary{
        background: linear-gradient(90deg,#6f42c1,#0dcaf0);
        border:0;
    }
    .btn-outline-light{
        border: 1px solid rgba(255,255,255,0.35);
    }
    .step-title{
        font-size: 20px;
        font-weight: 700;
    }
    .step-desc{
        font-size: 14px;
        color: rgba(232,240,255,0.8);
    }
    .question{
        margin-top: 20px;
        padding: 15px;
        border-radius: 14px;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.12);
    }
    .question h5{
        font-weight: 700;
    }
    .footer-note{
        font-size: 12px;
        color: rgba(232,240,255,0.6);
    }
    .badge-custom{
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.18);
    }
    #map{height: 300px; border-radius: 14px; border:1px solid rgba(255,255,255,0.2);}
</style>
</head>
<body>

<div class="container">
    <!-- Header -->
    <div class="card p-4 mb-4">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h2 class="mb-1">Structural Collapse Prediction AI (SCPA)</h2>
                <div class="footer-note">
                    A professional tool for **Jordan** (non-official).  
                    <span class="badge badge-custom">AI-based prediction</span> • <span class="badge badge-custom">ACI & ASCE referenced</span>
                </div>
                <div class="footer-note mt-2">
                    Owner: <b>Eng. Suhaib Al_Zyoud</b> • © 2026
                </div>
            </div>
            <div class="text-end">
                <button class="btn btn-outline-light btn-sm" onclick="toggleLang()">English / عربي</button>
                <button class="btn btn-outline-light btn-sm" onclick="goHome()">Home</button>
            </div>
        </div>
    </div>

    <!-- Step progress -->
    <div class="card p-3 mb-4">
        <div class="d-flex justify-content-between">
            <div class="step-title" id="stepTitle">Step 1: Building Basics</div>
            <div class="step-desc" id="stepDesc">Answer simple questions to evaluate progressive collapse risk.</div>
        </div>
        <div class="progress mt-3">
            <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
        </div>
    </div>

    <!-- Content -->
    <div id="content"></div>

    <!-- Footer -->
    <div class="card p-3 mt-4">
        <div class="footer-note">
            Disclaimer: This tool does NOT replace a structural engineer’s on-site inspection. It is an AI-based screening tool built using ACI & ASCE principles for educational and preliminary assessment only.
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const lang = { en: 0, ar: 1 };
let currentLang = lang.en;
let step = 0;

const steps = [
    {title: ["Step 1: Building Basics","الخطوة 1: بيانات المبنى الأساسية"], desc: ["Enter basic building info","أدخل بيانات المبنى الأساسية"]},
    {title: ["Step 2: Structural System","الخطوة 2: النظام الإنشائي"], desc: ["Structural components & connections","مكونات المبنى والروابط"]},
    {title: ["Step 3: Seismic & Site","الخطوة 3: الزلازل والموقع"], desc: ["Ground motion & soil type","حركة الأرض ونوع التربة"]},
    {title: ["Step 4: Damage & Changes","الخطوة 4: الأضرار والتعديلات"], desc: ["Existing damage or modifications","الأضرار أو التعديلات الحالية"]},
    {title: ["Step 5: Review & Report","الخطوة 5: المراجعة والتقرير"], desc: ["Final result and recommendations","النتيجة النهائية والتوصيات"]}
];

const questions = [
    // Step 1
    {step:0, q:["Building type","نوع المبنى"], options:[
        ["Residential","سكني"],
        ["Commercial","تجاري"],
        ["Industrial","صناعي"],
        ["Mixed-use","مختلط"],
        ["Other","أخرى"]
    ], key:"buildingType"},
    {step:0, q:["Number of stories","عدد الطوابق"], options:[
        ["1-3","1-3"],
        ["4-7","4-7"],
        ["8-12","8-12"],
        ["13-20","13-20"],
        ["21+","21+"]
    ], key:"stories"},
    {step:0, q:["Construction year (approx.)","سنة البناء (تقريباً)"], options:[
        ["Before 1980","قبل 1980"],
        ["1980-2000","1980-2000"],
        ["2001-2010","2001-2010"],
        ["2011-2020","2011-2020"],
        ["2021 or later","2021 أو أحدث"]
    ], key:"year"},
    {step:0, q:["Primary material","المادة الأساسية"], options:[
        ["Reinforced Concrete","خرسانة مسلحة"],
        ["Steel","فولاذ"],
        ["Masonry","إنشاءات حجر/طوب"],
        ["Composite","مركب"],
        ["Other","أخرى"]
    ], key:"material"},
    {step:0, q:["Is the building used for occupancy (residential/commercial)?","هل المبنى مستخدم للسكن أو التجارة؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Partially","جزئياً"],
        ["Vacant","شاغر"],
        ["Unknown","غير معروف"]
    ], key:"occupancy"},
    // Step 2
    {step:1, q:["Structural system","نظام الإنشاء"], options:[
        ["Moment-resisting frame","إطار مقاوم للعزم"],
        ["Shear wall system","نظام حوائط قص"],
        ["Dual system","نظام مزدوج"],
        ["Braced frame","إطار مع دعامات"],
        ["Unknown","غير معروف"]
    ], key:"structSystem"},
    {step:1, q:["Column type","نوع الأعمدة"], options:[
        ["Rectangular RC","أعمدة خرسانة مستطيلة"],
        ["Circular RC","أعمدة خرسانة دائرية"],
        ["Steel","فولاذ"],
        ["Composite","مركب"],
        ["Unknown","غير معروف"]
    ], key:"columnType"},
    {step:1, q:["Beam type","نوع الكمرات"], options:[
        ["RC beams","كمرات خرسانة"],
        ["Steel beams","كمرات فولاذ"],
        ["Precast","جاهزة"],
        ["Composite","مركب"],
        ["Unknown","غير معروف"]
    ], key:"beamType"},
    {step:1, q:["Is there a continuous load path (columns connected to foundation)?","هل يوجد مسار حمل مستمر من الأعمدة إلى الأساس؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Partially","جزئياً"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"loadPath"},
    {step:1, q:["Are the column-beam joints reinforced (hooks/anchors)?","هل تقوى وصلات الأعمدة بالكمرات (هوكات/تثبيت)؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Partially","جزئياً"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"jointReinforcement"},
    {step:1, q:["Is there a soft story (weak ground floor)?","هل يوجد طابق لين (أرضي ضعيف)؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Possible","محتمل"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"softStory"},
    {step:1, q:["Are there irregularities (re-entrant corners, setbacks)?","هل يوجد عدم انتظام (زوايا/تخفيضات)؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Minor","طفيفة"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"irregularity"},
    {step:1, q:["Is there a drop panel / slab thickening near columns?","هل يوجد slab drop panel أو سماكة حول الأعمدة؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Not sure","غير متأكد"],
        ["Not applicable","غير مطبق"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"dropPanel"},
    // Step 3
    {step:2, q:["Site location (city)","الموقع (المدينة)"], options:[
        ["Amman","عمان"],
        ["Zarqa","الزرقاء"],
        ["Irbid","إربد"],
        ["Aqaba","العقبة"],
        ["Other","أخرى"]
    ], key:"city"},
    {step:2, q:["Soil type (approx.)","نوع التربة (تقريباً)"], options:[
        ["Rock/Hard","صخر/صلب"],
        ["Stiff soil","تربة صلبة"],
        ["Soft soil","تربة لينة"],
        ["Fill material","مواد ردم"],
        ["Unknown","غير معروف"]
    ], key:"soil"},
    {step:2, q:["Seismic zone (approx.)","منطقة زلزالية (تقريباً)"], options:[
        ["Low","منخفض"],
        ["Moderate","متوسط"],
        ["High","عالي"],
        ["Very high","عالي جداً"],
        ["Unknown","غير معروف"]
    ], key:"seismicZone"},
    {step:2, q:["Is the building near a fault line or hillside?","هل المبنى قريب من صدع زلزالي أو تلة؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Possible","محتمل"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"nearFault"},
    {step:2, q:["Has the building experienced significant shaking before?","هل تعرض المبنى لهزات قوية سابقاً؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Not sure","غير متأكد"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"pastShaking"},
    // Step 4
    {step:3, q:["Visible cracks in columns or beams?","هل توجد تشققات واضحة في الأعمدة أو الكمرات؟"], options:[
        ["None","لا يوجد"],
        ["Hairline","سطحية"],
        ["Moderate","متوسطة"],
        ["Severe","شديدة"],
        ["Unknown","غير معروف"]
    ], key:"cracks"},
    {step:3, q:["Corrosion or exposed rebar?","هل يوجد تآكل أو حديد مكشوف؟"], options:[
        ["None","لا يوجد"],
        ["Minor","طفيفة"],
        ["Moderate","متوسطة"],
        ["Severe","شديدة"],
        ["Unknown","غير معروف"]
    ], key:"corrosion"},
    {step:3, q:["Any structural modifications (walls removed, openings added)?","هل تم تعديل إنشائي (إزالة حوائط، فتحات جديدة)؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Partial","جزئياً"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"modifications"},
    {step:3, q:["Has the building been repaired after damage?","هل تم إصلاح المبنى بعد ضرر؟"], options:[
        ["Yes (professional)","نعم (بشكل مهني)"],
        ["Yes (temporary)","نعم (مؤقت)"],
        ["No","لا"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"repairs"},
    {step:3, q:["Is there water leakage or foundation settlement?","هل يوجد تسرب مياه أو هبوط أساس؟"], options:[
        ["None","لا يوجد"],
        ["Minor","طفيف"],
        ["Moderate","متوسط"],
        ["Severe","شديد"],
        ["Unknown","غير معروف"]
    ], key:"leakage"},
    {step:3, q:["Is the building occupancy load increased beyond design?","هل زادت الأحمال عن التصميم؟"], options:[
        ["Yes","نعم"],
        ["No","لا"],
        ["Possible","محتمل"],
        ["Unknown","غير معروف"],
        ["Needs inspection","يحتاج فحص"]
    ], key:"overload"},
    // Step 5: review
    {step:4, q:["Final inspection readiness","جاهزية الفحص النهائي"], options:[
        ["Ready","جاهز"],
        ["Needs more data","يحتاج بيانات أكثر"],
        ["Needs professional inspection","يحتاج فحص مهني"],
        ["Unsafe to inspect","غير آمن للفحص"],
        ["Unknown","غير معروف"]
    ], key:"finalReady"}
];

let answers = {};

function toggleLang(){
    currentLang = currentLang === lang.en ? lang.ar : lang.en;
    renderStep();
}

function goHome(){
    step = 0;
    answers = {};
    renderStep();
}

function updateProgress(){
    const progress = Math.round((step / (steps.length-1)) * 100);
    document.getElementById("progressBar").style.width = progress + "%";
}

function renderStep(){
    updateProgress();
    document.getElementById("stepTitle").innerText = steps[step].title[currentLang];
    document.getElementById("stepDesc").innerText = steps[step].desc[currentLang];

    const content = document.getElementById("content");
    content.innerHTML = "";

    if(step < steps.length - 1){
        // questions
        const stepQuestions = questions.filter(q => q.step === step);
        stepQuestions.forEach((q, idx) => {
            const qDiv = document.createElement("div");
            qDiv.className = "question";
            qDiv.innerHTML = `
                <h5>${idx+1}. ${q.q[currentLang]}</h5>
                <div class="mt-2">
                    ${q.options.map((opt, i) => `
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="${q.key}" id="${q.key}_${i}" value="${opt[currentLang]}">
                            <label class="form-check-label" for="${q.key}_${i}">${opt[currentLang]}</label>
                        </div>
                    `).join("")}
                </div>
            `;
            content.appendChild(qDiv);
        });

        const nav = document.createElement("div");
        nav.className = "mt-4 d-flex justify-content-between";
        nav.innerHTML = `
            <button class="btn btn-outline-light" onclick="goHome()">${currentLang===lang.en ? "Back to Home" : "العودة للرئيسية"}</button>
            <button class="btn btn-primary" onclick="nextStep()">${currentLang===lang.en ? "Next" : "التالي"}</button>
        `;
        content.appendChild(nav);
    } else {
        renderReport();
    }
}

function nextStep(){
    // collect answers
    const stepQuestions = questions.filter(q => q.step === step);
    for(const q of stepQuestions){
        const selected = document.querySelector(`input[name="${q.key}"]:checked`);
        if(!selected){
            alert(currentLang===lang.en ? "Please answer all questions before proceeding." : "يرجى الإجابة عن جميع الأسئلة قبل المتابعة.");
            return;
        }
        answers[q.key] = selected.value;
    }
    step++;
    renderStep();
}

function calcScore(){
    let score = 0;
    // Simple scoring model (can be improved later)
    const riskMap = {
        buildingType: {"Residential":1,"Commercial":2,"Industrial":3,"Mixed-use":2,"Other":2,
                       "سكني":1,"تجاري":2,"صناعي":3,"مختلط":2,"أخرى":2},
        stories: {"1-3":1,"4-7":2,"8-12":3,"13-20":4,"21+":5,
                  "1-3":1,"4-7":2,"8-12":3,"13-20":4,"21+":5},
        year: {"Before 1980":5,"1980-2000":4,"2001-2010":3,"2011-2020":2,"2021 or later":1,
               "قبل 1980":5,"1980-2000":4,"2001-2010":3,"2011-2020":2,"2021 أو أحدث":1},
        material: {"Reinforced Concrete":2,"Steel":2,"Masonry":4,"Composite":2,"Other":3,
                   "خرسانة مسلحة":2,"فولاذ":2,"إنشاءات حجر/طوب":4,"مركب":2,"أخرى":3},
        occupancy: {"Yes":2,"No":1,"Partially":2,"Vacant":1,"Unknown":3,
                    "نعم":2,"لا":1,"جزئياً":2,"شاغر":1,"غير معروف":3},
        structSystem: {"Moment-resisting frame":2,"Shear wall system":1,"Dual system":1,"Braced frame":2,"Unknown":3,
                       "إطار مقاوم للعزم":2,"نظام حوائط قص":1,"نظام مزدوج":1,"إطار مع دعامات":2,"غير معروف":3},
        loadPath: {"Yes":1,"No":5,"Partially":3,"Unknown":4,"Needs inspection":4,
                   "نعم":1,"لا":5,"جزئياً":3,"غير معروف":4,"يحتاج فحص":4},
        jointReinforcement: {"Yes":1,"No":5,"Partially":3,"Unknown":4,"Needs inspection":4,
                             "نعم":1,"لا":5,"جزئياً":3,"غير معروف":4,"يحتاج فحص":4},
        softStory: {"Yes":5,"No":1,"Possible":3,"Unknown":4,"Needs inspection":4,
                    "نعم":5,"لا":1,"محتمل":3,"غير معروف":4,"يحتاج فحص":4},
        irregularity: {"Yes":4,"No":1,"Minor":2,"Unknown":3,"Needs inspection":3,
                       "نعم":4,"لا":1,"طفيفة":2,"غير معروف":3,"يحتاج فحص":3},
        dropPanel: {"Yes":1,"No":3,"Not sure":4,"Not applicable":1,"Needs inspection":4,
                    "نعم":1,"لا":3,"غير متأكد":4,"غير مطبق":1,"يحتاج فحص":4},
        soil: {"Rock/Hard":1,"Stiff soil":2,"Soft soil":4,"Fill material":5,"Unknown":3,
               "صخر/صلب":1,"تربة صلبة":2,"تربة لينة":4,"مواد ردم":5,"غير معروف":3},
        seismicZone: {"Low":1,"Moderate":3,"High":4,"Very high":5,"Unknown":3,
                      "منخفض":1,"متوسط":3,"عالي":4,"عالي جداً":5,"غير معروف":3},
        nearFault: {"Yes":5,"No":1,"Possible":3,"Unknown":4,"Needs inspection":4,
                    "نعم":5,"لا":1,"محتمل":3,"غير معروف":4,"يحتاج فحص":4},
        pastShaking: {"Yes":4,"No":1,"Not sure":3,"Unknown":3,"Needs inspection":4,
                      "نعم":4,"لا":1,"غير متأكد":3,"غير معروف":3,"يحتاج فحص":4},
        cracks: {"None":1,"Hairline":2,"Moderate":3,"Severe":5,"Unknown":4,
                 "لا يوجد":1,"سطحية":2,"متوسطة":3,"شديدة":5,"غير معروف":4},
        corrosion: {"None":1,"Minor":2,"Moderate":3,"Severe":5,"Unknown":4,
                    "لا يوجد":1,"طفيفة":2,"متوسطة":3,"شديدة":5,"غير معروف":4},
        modifications: {"Yes":4,"No":1,"Partial":3,"Unknown":3,"Needs inspection":4,
                        "نعم":4,"لا":1,"جزئياً":3,"غير معروف":3,"يحتاج فحص":4},
        repairs: {"Yes (professional)":1,"Yes (temporary)":3,"No":4,"Unknown":3,"Needs inspection":4,
                  "نعم (بشكل مهني)":1,"نعم (مؤقت)":3,"لا":4,"غير معروف":3,"يحتاج فحص":4},
        leakage: {"None":1,"Minor":2,"Moderate":3,"Severe":5,"Unknown":4,
                  "لا يوجد":1,"طفيف":2,"متوسط":3,"شديد":5,"غير معروف":4},
        overload: {"Yes":4,"No":1,"Possible":3,"Unknown":3,"Needs inspection":4,
                   "نعم":4,"لا":1,"محتمل":3,"غير معروف":3,"يحتاج فحص":4},
        finalReady: {"Ready":1,"Needs more data":3,"Needs professional inspection":4,"Unsafe to inspect":5,"Unknown":3,
                     "جاهز":1,"يحتاج بيانات أكثر":3,"يحتاج فحص مهني":4,"غير آمن للفحص":5,"غير معروف":3}
    };

    for(const k in answers){
        const val = answers[k];
        score += (riskMap[k] && riskMap[k][val]) ? riskMap[k][val] : 3;
    }

    return score;
}

function classify(score){
    if(score <= 40) return {level:"Low Risk", levelAr:"خطر منخفض", color:"#0dcaf0", desc:"The building shows low progressive collapse risk based on available data."};
    if(score <= 70) return {level:"Moderate Risk", levelAr:"خطر متوسط", color:"#ffc107", desc:"The building shows moderate risk; professional inspection recommended."};
    return {level:"High Risk", levelAr:"خطر عالي", color:"#dc3545", desc:"High risk of progressive collapse. Immediate structural assessment required."};
}

function renderReport(){
    const content = document.getElementById("content");
    content.innerHTML = "";

    const score = calcScore();
    const classification = classify(score);

    const reportHTML = `
        <div class="card p-4">
            <h3>${currentLang===lang.en ? "Final Report" : "التقرير النهائي"}</h3>
            <div class="mt-3">
                <span class="badge badge-custom" style="background:${classification.color}; color:#fff;">
                    ${currentLang===lang.en ? classification.level : classification.levelAr}
                </span>
                <span class="badge badge-custom ms-2">
                    ${currentLang===lang.en ? "Score" : "النتيجة"}: <b>${score}</b>
                </span>
            </div>
            <div class="mt-3">
                <h5>${currentLang===lang.en ? "Summary" : "الملخص"}</h5>
                <p>${currentLang===lang.en ? classification.desc : "المبنى يظهر خطر " + classification.levelAr + " بناءً على البيانات المدخلة."}</p>
            </div>

            <div class="mt-3">
                <h5>${currentLang===lang.en ? "Key Risk Factors" : "العوامل الرئيسية للخطر"}</h5>
                <ul>
                    ${generateRiskFactors()}
                </ul>
            </div>

            <div class="mt-3">
                <h5>${currentLang===lang.en ? "Recommendations" : "التوصيات"}</h5>
                <ul>
                    ${generateRecommendations(classification.level)}
                </ul>
            </div>

            <div class="mt-3">
                <h5>${currentLang===lang.en ? "Code References" : "المرجعيات الكودية"}</h5>
                <p>${currentLang===lang.en ? 
                    "This screening tool is based on general principles from ACI 318 & ASCE 7 (Seismic Design) and does not replace professional engineering analysis." : 
                    "هذه الأداة تعتمد على مبادئ عامة من ACI 318 و ASCE 7 (التصميم الزلزالي) ولا تغني عن تحليل مهندس مختص."}
                </p>
            </div>

            <div class="mt-4 d-flex justify-content-between">
                <button class="btn btn-outline-light" onclick="goHome()">${currentLang===lang.en ? "Start Over" : "إعادة البدء"}</button>
                <button class="btn btn-primary" onclick="downloadPDF()">${currentLang===lang.en ? "Download PDF" : "تحميل PDF"}</button>
            </div>

            <div class="mt-3 footer-note">
                ${currentLang===lang.en ? 
                    "Note: This tool is a preliminary screening and not a substitute for on-site structural inspection." : 
                    "ملاحظة: هذه الأداة فحص أولي ولا تغني عن الفحص الميداني الإنشائي."}
            </div>
        </div>
    `;

    content.innerHTML = reportHTML;
}

function generateRiskFactors(){
    let items = [];
    if(answers.softStory && (answers.softStory === "Yes" || answers.softStory === "نعم")) items.push(currentLang===lang.en ? "Soft story detected (weak ground floor)." : "وجود طابق لين (أرضي ضعيف).");
    if(answers.loadPath && (answers.loadPath === "No" || answers.loadPath === "لا")) items.push(currentLang===lang.en ? "Discontinuous load path (potential collapse risk)." : "عدم وجود مسار حمل مستمر.");
    if(answers.jointReinforcement && (answers.jointReinforcement === "No" || answers.jointReinforcement === "لا")) items.push(currentLang===lang.en ? "Weak column-beam joints (insufficient reinforcement)." : "ضعف وصلات الأعمدة بالكمرات.");
    if(answers.seismicZone && (answers.seismicZone === "High" || answers.seismicZone === "عالي" || answers.seismicZone === "Very high" || answers.seismicZone === "عالي جداً")) items.push(currentLang===lang.en ? "High seismic hazard area." : "منطقة زلزالية عالية.");
    if(answers.cracks && (answers.cracks === "Moderate" || answers.cracks === "Severe" || answers.cracks === "متوسطة" || answers.cracks === "شديدة")) items.push(currentLang===lang.en ? "Significant structural cracks." : "تشققات إنشائية كبيرة.");
    if(answers.corrosion && (answers.corrosion === "Moderate" || answers.corrosion === "Severe" || answers.corrosion === "متوسطة" || answers.corrosion === "شديدة")) items.push(currentLang===lang.en ? "Corrosion or exposed reinforcement." : "تآكل أو حديد مكشوف.");

    if(items.length === 0) items.push(currentLang===lang.en ? "No major risk factors detected from the provided data." : "لم يتم اكتشاف عوامل خطر كبيرة من البيانات المدخلة.");
    return items.map(i => `<li>${i}</li>`).join("");
}

function generateRecommendations(level){
    if(level === "Low Risk"){
        return [
            currentLang===lang.en ? "Periodic monitoring and maintenance." : "مراقبة وصيانة دورية.",
            currentLang===lang.en ? "Verify design documents if available." : "التحقق من المخططات إن وجدت.",
            currentLang===lang.en ? "Perform a professional inspection every 5–10 years." : "إجراء فحص مهني كل 5–10 سنوات."
        ].map(i => `<li>${i}</li>`).join("");
    }
    if(level === "Moderate Risk"){
        return [
            currentLang===lang.en ? "Schedule a structural engineer inspection (on-site)." : "جدولة فحص مهندس إنشائي (ميداني).",
            currentLang===lang.en ? "Check column-beam joints and load path continuity." : "فحص وصلات الأعمدة والكمرات ومسار الحمل.",
            currentLang===lang.en ? "Evaluate seismic retrofitting options if needed." : "تقييم خيارات تقوية مقاومة الزلازل."
        ].map(i => `<li>${i}</li>`).join("");
    }
    return [
        currentLang===lang.en ? "Immediate structural assessment by a qualified engineer." : "تقييم إنشائي عاجل بواسطة مهندس مختص.",
        currentLang===lang.en ? "Avoid occupancy until safety is confirmed." : "تجنب الإشغال حتى التأكد من السلامة.",
        currentLang===lang.en ? "Consider emergency strengthening (shear walls, bracing, column jackets)." : "النظر في تقوية عاجلة (حوائط قص، دعامات، تقوية أعمدة).",
        currentLang===lang.en ? "Review and comply with ACI 318 & ASCE 7 recommendations." : "مراجعة والالتزام بتوصيات ACI 318 و ASCE 7."
    ].map(i => `<li>${i}</li>`).join("");
}

async function downloadPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'pt', 'a4');
    const element = document.querySelector("#content");
    const canvas = await html2canvas(element, { scale: 2 });
    const imgData = canvas.toDataURL('image/png');
    const imgProps = doc.getImageProperties(imgData);
    const pdfWidth = doc.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
    doc.save('SCPA_Report.pdf');
}

renderStep();
</script>

</body>
</html>
